# CLAUDE.md ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Svetofor MVP (WB Analytics)

## üìã –û –ø—Ä–æ–µ–∫—Ç–µ
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ 700+ —Ç–æ–≤–∞—Ä–æ–≤ Wildberries
- **–°—Ç–µ–∫:** Next.js + TypeScript + Supabase + Tailwind
- **–§—É–Ω–∫—Ü–∏–∏:** –°–≤–µ—Ç–æ—Ñ–æ—Ä –∞–Ω–æ–º–∞–ª–∏–π, –≤–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π, –ø–ª–∞–Ω/—Ñ–∞–∫—Ç, –∑–∞–¥–∞—á–∏

---

## üî¥ –ì–õ–ê–í–ù–´–ï –ü–†–ê–í–ò–õ–ê

### –ü–µ—Ä–µ–¥ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–¥–∞:
1. –ü–æ–∫–∞–∂–∏ –ø–ª–∞–Ω (3-5 –ø—É–Ω–∫—Ç–æ–≤)
2. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±–æ–ª—å—à–∞—è ‚Äî —Å–ø—Ä–æ—Å–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
3. –ù–µ —É–≤–µ—Ä–µ–Ω ‚Äî —Å–ø—Ä–æ—Å–∏, –Ω–µ —É–≥–∞–¥—ã–≤–∞–π

### –ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞:
1. **–ü—Ä–æ–≤–µ—Ä—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å** ‚Äî –Ω–µ—Ç –ª–∏ –æ–ø–µ—á–∞—Ç–æ–∫
2. **–ù–∞–π–¥–∏ 3 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏** ‚Äî –Ω–∞–ø–∏—à–∏ –∏—Ö
3. **–î–æ–±–∞–≤—å console.log** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **–ü—Ä–æ–≤–µ—Ä—å —Ç–∏–ø—ã TypeScript**

### –ü—Ä–∏ –æ—à–∏–±–∫–µ:
1. –ü–æ–∫–∞–∂–∏ –ü–û–õ–ù–´–ô —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
2. –û–±—ä—è—Å–Ω–∏ —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
3. –ú–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
4. –ü–æ—Å–ª–µ 2 –Ω–µ—É–¥–∞—á ‚Äî –°–¢–û–ü, —Å–ø—Ä–æ—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
src/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ api/               # API endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ svetofor/      # –û—Å–Ω–æ–≤–Ω–æ–π API —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-analysis/   # AI –∞–Ω–∞–ª–∏–∑
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ goals/         # –¶–µ–ª–∏/–ø–ª–∞–Ω-—Ñ–∞–∫—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ optimizer/     # –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä —Ü–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ goals/             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ü–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ tasks/             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx           # –ì–ª–∞–≤–Ω–∞—è (–¥–∞—à–±–æ—Ä–¥)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ai/                # AI –ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/         # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ goals/             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ü–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ tasks/             # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ layout/            # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ optimizer/         # –î–≤–∏–∂–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ signal-engine.ts   # –î–µ—Ç–µ–∫—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤/–∞–Ω–æ–º–∞–ª–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts        # –ö–ª–∏–µ–Ω—Ç Supabase
‚îÇ   ‚îî‚îÄ‚îÄ wb-api.ts          # API Wildberries
‚îî‚îÄ‚îÄ types/                 # TypeScript —Ç–∏–ø—ã
```

---

## üìä –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê

### –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ WB:
```typescript
// –ü–æ–∫–∞–∑—ã ‚Üí –ö–ª–∏–∫–∏ ‚Üí –ö–æ—Ä–∑–∏–Ω–∞ ‚Üí –ó–∞–∫–∞–∑—ã ‚Üí –í—ã–∫—É–ø
const metrics = {
  ctr: clicks / views * 100,           // Click-through rate
  cr: orders / clicks * 100,           // Conversion rate
  cartRate: cart / clicks * 100,       // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
  buyoutRate: buyout / orders * 100,   // –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–∫—É–ø–∞
}
```

### –ü–æ—Ä–æ–≥–∏ –∞–Ω–æ–º–∞–ª–∏–π (—Å–≤–µ—Ç–æ—Ñ–æ—Ä):
```typescript
// –ò–∑ config/global.yaml –∏–ª–∏ lib/signal-engine.ts
const thresholds = {
  ctr: { red: 1, yellow: 3, green: 5 },        // %
  cr: { red: 2, yellow: 5, green: 10 },        // %
  buyout: { red: 50, yellow: 70, green: 85 },  // %
  change: 0.3,  // 30% –∏–∑–º–µ–Ω–µ–Ω–∏–µ = –∞–Ω–æ–º–∞–ª–∏—è
}
```

### –¶–≤–µ—Ç–∞ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞:
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π:** –ö—Ä–∏—Ç–∏—á–Ω–æ, –Ω—É–∂–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ
- üü° **–ñ—ë–ª—Ç—ã–π:** –í–Ω–∏–º–∞–Ω–∏–µ, —Å–ª–µ–¥–∏—Ç—å
- üü¢ **–ó–µ–ª—ë–Ω—ã–π:** –ù–æ—Ä–º–∞

---

## üõ† –°–¢–ê–ù–î–ê–†–¢–´ –ö–û–î–ê

### TypeScript ‚Äî –≤—Å–µ–≥–¥–∞ —Ç–∏–ø–∏–∑–∏—Ä—É–π:
```typescript
// ‚úÖ –•–æ—Ä–æ—à–æ
interface SKUData {
  sku: string;
  views: number;
  clicks: number;
  orders: number;
}

const calcCTR = (data: SKUData): number => {
  if (!data.views || data.views === 0) return 0;
  return (data.clicks / data.views) * 100;
};

// ‚ùå –ü–ª–æ—Ö–æ
const calcCTR = (data: any) => data.clicks / data.views * 100;
```

### API routes ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏:
```typescript
// src/app/api/example/route.ts
export async function GET(request: Request) {
  try {
    const data = await fetchData();
    console.log('[API] –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π:', data.length); // –õ–æ–≥
    return Response.json({ data });
  } catch (error) {
    console.error('[API] –û—à–∏–±–∫–∞:', error);
    return Response.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã React:
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–π –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç
export function MyComponent({ data }: Props) {
  // –ü—Ä–æ–≤–µ—Ä—è–π –¥–∞–Ω–Ω—ã–µ
  if (!data || data.length === 0) {
    return <div>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>;
  }
  
  return <div>...</div>;
}
```

### Supabase –∑–∞–ø—Ä–æ—Å—ã:
```typescript
// –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π error
const { data, error } = await supabase
  .from('analytics')
  .select('*')
  .eq('sku', sku);

if (error) {
  console.error('[Supabase] –û—à–∏–±–∫–∞:', error.message);
  throw error;
}

console.log('[Supabase] –ó–∞–ø–∏—Å–µ–π:', data?.length);
```

---

## ‚ö†Ô∏è –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| `NaN` –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ 0 | –ü—Ä–æ–≤–µ—Ä—å `if (!views) return 0` |
| `undefined is not iterable` | –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç API | –ü—Ä–æ–≤–µ—Ä—å `data?.length` |
| `Cannot read property` | null –æ–±—ä–µ–∫—Ç | –ò—Å–ø–æ–ª—å–∑—É–π optional chaining `?.` |
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞—Ç—ã | –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ | –ò—Å–ø–æ–ª—å–∑—É–π UTC –∏–ª–∏ dayjs |
| –ü—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ | –§–∏–ª—å—Ç—Ä—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç | –õ–æ–≥–∏—Ä—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ |

---

## üéØ –ü–õ–ê–ù/–§–ê–ö–¢

### –§–æ—Ä–º—É–ª—ã:
```typescript
const planFact = {
  completion: (fact / plan) * 100,
  deviation: fact - plan,
  deviationPercent: ((fact - plan) / plan) * 100,
}

// –¶–≤–µ—Ç –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
const getStatusColor = (completion: number) => {
  if (completion >= 100) return 'green';
  if (completion >= 80) return 'yellow';
  return 'red';
};
```

---

## üö® –î–ï–¢–ï–ö–¶–ò–Ø –ê–ù–û–ú–ê–õ–ò–ô

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤ signal-engine.ts:
```typescript
const detectAnomaly = (
  current: number,
  previous: number,
  threshold = 0.3
): boolean => {
  if (!previous || previous === 0) return false;
  const change = Math.abs((current - previous) / previous);
  return change > threshold;
};

// –ü—Ä–æ–≤–µ—Ä–∫–∏
const signals = {
  ctrDrop: detectAnomaly(todayCTR, yesterdayCTR),
  crDrop: detectAnomaly(todayCR, yesterdayCR),
  zeroOrders: views > 1000 && orders === 0,
  lowBuyout: buyoutRate < 50,
};
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –ö–û–ú–ú–ò–¢–û–ú

- [ ] `npm run build` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] TypeScript –æ—à–∏–±–æ–∫ –Ω–µ—Ç
- [ ] –ù–µ—Ç `console.log` —Å sensitive –¥–∞–Ω–Ω—ã–º–∏ (API keys)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null/undefined –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- [ ] API endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ

---

## üìù –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–û–í

```
üìã –ü–õ–ê–ù:
1. ...
2. ...

üíª –ö–û–î:
[–∫–æ–¥]

‚úÖ –ü–†–û–í–ï–†–ö–ê:
- TypeScript: –û–ö/–æ—à–∏–±–∫–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: [—Å–ø–∏—Å–æ–∫]
- –¢–µ—Å—Ç: [–∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å]

‚ö†Ô∏è –í–û–ü–†–û–°–´ (–µ—Å–ª–∏ –µ—Å—Ç—å):
```

---

## üö´ –ù–ï –î–ï–õ–ê–ô

- –ù–µ –º–µ–Ω—è–π —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∫–æ–¥ –±–µ–∑ —è–≤–Ω–æ–π –ø—Ä–æ—Å—å–±—ã
- –ù–µ —É–¥–∞–ª—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ª–æ–≥–∏
- –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π TypeScript –æ—à–∏–±–∫–∏
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥—å –¥–∞–Ω–Ω—ã–µ (API keys, URLs)
- –ù–µ –¥–µ–ª–∞–π –±–æ–ª—å—à–µ —á–µ–º –ø—Ä–æ—Å—è—Ç
- –ù–µ —Ç—Ä–æ–≥–∞–π .env.local
- –ù–µ —É–¥–∞–ª—è–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫

---

## üîß –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´

```bash
npm run dev          # –ó–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞
npm run build        # –°–±–æ—Ä–∫–∞
npm run lint         # –ü—Ä–æ–≤–µ—Ä–∫–∞ ESLint
npx tsc --noEmit     # –ü—Ä–æ–≤–µ—Ä–∫–∞ TypeScript
```

---

## üìö –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´

- `src/lib/signal-engine.ts` ‚Äî –ª–æ–≥–∏–∫–∞ —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞
- `src/lib/optimizer/` ‚Äî –¥–≤–∏–∂–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ü–µ–Ω
- `src/app/api/svetofor/route.ts` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π API
- `config/global.yaml` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
- `supabase-schema.sql` ‚Äî —Å—Ö–µ–º–∞ –ë–î
